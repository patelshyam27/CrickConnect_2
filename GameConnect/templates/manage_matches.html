{% extends "base.html" %}

{% block title %}Manage Live Matches - CrickConnect{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-play-circle me-2"></i>Manage Live Matches</h2>
                <div>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMatchModal">
                        <i class="fas fa-plus me-2"></i>Add Live Match
                    </button>
                    <a href="{{ url_for('admin_dashboard') if session.get('is_admin') else url_for('owner_dashboard') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Live Matches List -->
    <div class="row">
        {% if live_matches %}
        {% for match in live_matches %}
        <div class="col-lg-6 mb-4">
            <div class="card content-management-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">{{ match.title }}</h5>
                    {% if match.is_live %}
                    <span class="badge bg-danger">LIVE</span>
                    {% else %}
                    <span class="badge bg-secondary">Recorded</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <p>{{ match.description }}</p>
                    
                    {% if match.teams %}
                    <p><strong>Teams:</strong> {{ match.teams }}</p>
                    {% endif %}
                    
                    {% if match.location or match.state or match.city or match.area %}
                    <p>
                        <strong>Location:</strong> 
                        {% if match.location %}{{ match.location }}{% endif %}
                        {% if match.area or match.city or match.state %}
                            ({% if match.area %}{{ match.area }}{% endif %}
                            {% if match.city %}{% if match.area %}, {% endif %}{{ match.city }}{% endif %}
                            {% if match.state %}{% if match.city or match.area %}, {% endif %}{{ match.state }}{% endif %})
                        {% endif %}
                    </p>
                    {% endif %}
                    
                    <p><strong>YouTube URL:</strong> 
                        <a href="{{ match.youtube_url }}" target="_blank" class="text-break">{{ match.youtube_url }}</a>
                    </p>
                    
                    <!-- YouTube Embed Preview -->
                    <div class="ratio ratio-16x9 mb-3">
                        <iframe src="{{ match.youtube_url | youtube_embed }}" allowfullscreen></iframe>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <small class="text-muted">
                            Added on {{ match.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                        </small>
                        {% if session.get('is_owner') or match.created_by == session.get('admin_id') %}
                        <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ match.id }}">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                        
                        <!-- Delete Confirmation Modal -->
                        <div class="modal fade" id="deleteModal{{ match.id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Confirm Deletion</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form method="POST" action="{{ url_for('delete_live_match', match_id=match.id) }}">
                                        <div class="modal-body">
                                            <p>Are you sure you want to delete this live match?</p>
                                            <p><strong>{{ match.title }}</strong></p>
                                            
                                            <div class="mb-3">
                                                <label for="deletePassword{{ match.id }}" class="form-label">Enter password to confirm deletion:</label>
                                                <input type="password" class="form-control" id="deletePassword{{ match.id }}" name="delete_password" required>
                                                <div class="form-text text-muted">Password: deletedata</div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-play-circle display-1 text-muted mb-3"></i>
                <h4>No live matches yet</h4>
                <p class="text-muted">Add your first live cricket match for the community to watch.</p>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMatchModal">
                    <i class="fas fa-plus me-2"></i>Add First Live Match
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add Match Modal -->
<div class="modal fade" id="addMatchModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Live Cricket Match</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('add_live_match') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="title" class="form-label">Match Title</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teams" class="form-label">Teams</label>
                            <input type="text" class="form-control" id="teams" name="teams" placeholder="Team A vs Team B">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="is_live" class="form-label">Status</label>
                            <select class="form-select" id="is_live" name="is_live">
                                <option value="1">Live</option>
                                <option value="0">Recorded</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="location" class="form-label">Match Location</label>
                        <input type="text" class="form-control" id="location" name="location" placeholder="Stadium or venue name">
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="state" class="form-label">State</label>
                            <input type="text" class="form-control" id="state" name="state">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="city" class="form-label">City</label>
                            <input type="text" class="form-control" id="city" name="city">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="area" class="form-label">Area</label>
                            <input type="text" class="form-control" id="area" name="area">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="youtube_url" class="form-label">YouTube URL</label>
                        <input type="url" class="form-control" id="youtube_url" name="youtube_url" required
                               placeholder="https://www.youtube.com/watch?v=VIDEO_ID">
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Paste the YouTube video URL (supports both youtube.com/watch?v= and youtu.be/ formats)
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Add Live Match
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
